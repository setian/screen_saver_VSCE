"use strict";var q=Object.create;var E=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var V=Object.getPrototypeOf,X=Object.prototype.hasOwnProperty;var Q=(e,n)=>{for(var t in n)E(e,t,{get:n[t],enumerable:!0})},M=(e,n,t,s)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of B(n))!X.call(e,i)&&i!==t&&E(e,i,{get:()=>n[i],enumerable:!(s=z(n,i))||s.enumerable});return e};var A=(e,n,t)=>(t=e!=null?q(V(e)):{},M(n||!e||!e.__esModule?E(t,"default",{value:e,enumerable:!0}):t,e)),Y=e=>M(E({},"__esModule",{value:!0}),e);var Ie={};Q(Ie,{activate:()=>ve,deactivate:()=>ye});module.exports=Y(Ie);var r=A(require("vscode")),b=A(require("fs")),P=A(require("path")),F=[{code:"// Offline fallback: add entries to docs/code-pack.json (or .md) to customize snippets.",languageId:"plaintext"}],p,w,y,O="plaintext",I=new Map,x,m=[],Z=6*60*60*1e3,ee={javascriptreact:"javascript",typescriptreact:"typescript",react:"javascript","c++":"cpp","objective-c++":"cpp","objective-c":"c",shellscript:"shell",shell:"shell",bash:"shell",zsh:"shell",sh:"shell",jsonc:"json",json5:"json",md:"plaintext",markdown:"plaintext","c#":"csharp",cs:"csharp",ps:"powershell",ps1:"powershell",psm1:"powershell",psd1:"powershell",powershellscript:"powershell",yml:"yaml",ts:"typescript",py:"python",rb:"ruby"},N={brainfuck:[".bf"],c:[".c",".h"],csharp:[".cs"],cpp:[".cc",".cpp",".cxx",".hpp",".hh",".hxx"],css:[".css"],go:[".go"],html:[".html",".htm"],java:[".java"],javascript:[".js",".jsx",".mjs",".cjs"],json:[".json"],kotlin:[".kt"],lua:[".lua"],php:[".php"],powershell:[".ps1",".psm1"],python:[".py"],ruby:[".rb"],rust:[".rs"],scala:[".scala"],shell:[".sh",".bash",".zsh"],sql:[".sql"],swift:[".swift"],typescript:[".ts",".tsx"],yaml:[".yml",".yaml"],plaintext:[".md",".markdown",".txt"]},ne=new Set(Object.values(N).flat()),te=6,se=.12;function a(e,n="log",...t){let i=`[${new Date().toLocaleTimeString()}] ${e}`;switch(n){case"warn":console.warn(i,...t);break;case"error":console.error(i,...t);break;default:console.log(i,...t);break}}var U=[{label:"TheAlgorithms \xB7 Python",owner:"TheAlgorithms",repo:"Python",license:"MIT",licenseUrl:"https://github.com/TheAlgorithms/Python/blob/master/LICENSE",languages:["python"]},{label:"TheAlgorithms \xB7 JavaScript",owner:"TheAlgorithms",repo:"JavaScript",license:"MIT",licenseUrl:"https://github.com/TheAlgorithms/JavaScript/blob/master/LICENSE",languages:["javascript","typescript"]},{label:"TheAlgorithms \xB7 Java",owner:"TheAlgorithms",repo:"Java",license:"MIT",licenseUrl:"https://github.com/TheAlgorithms/Java/blob/master/LICENSE",languages:["java"]},{label:"TheAlgorithms \xB7 C",owner:"TheAlgorithms",repo:"C",license:"MIT",licenseUrl:"https://github.com/TheAlgorithms/C/blob/main/LICENSE",languages:["c"]},{label:"TheAlgorithms \xB7 C++",owner:"TheAlgorithms",repo:"C-Plus-Plus",license:"MIT",licenseUrl:"https://github.com/TheAlgorithms/C-Plus-Plus/blob/master/LICENSE",languages:["cpp"]},{label:"TheAlgorithms \xB7 Go",owner:"TheAlgorithms",repo:"Go",license:"MIT",licenseUrl:"https://github.com/TheAlgorithms/Go/blob/master/LICENSE",languages:["go"]},{label:"TheAlgorithms \xB7 Rust",owner:"TheAlgorithms",repo:"Rust",license:"MIT",licenseUrl:"https://github.com/TheAlgorithms/Rust/blob/master/LICENSE",languages:["rust"]},{label:"TheAlgorithms \xB7 Kotlin",owner:"TheAlgorithms",repo:"Kotlin",license:"MIT",licenseUrl:"https://github.com/TheAlgorithms/Kotlin/blob/master/LICENSE",languages:["kotlin"]},{label:"30 Seconds of Code",owner:"30-seconds",repo:"30-seconds-of-code",license:"CC0 1.0 Universal",licenseUrl:"https://github.com/30-seconds/30-seconds-of-code/blob/master/LICENSE",languages:["javascript","typescript","react"]},{label:"1loc",owner:"phuoc-ng",repo:"1loc",license:"MIT",licenseUrl:"https://github.com/phuoc-ng/1loc/blob/master/LICENSE",languages:["javascript"]},{label:"leachim6 \xB7 Hello World",owner:"leachim6",repo:"hello-world",license:"CC BY 4.0",licenseUrl:"https://github.com/leachim6/hello-world/blob/master/LICENSE",languages:["plaintext","c","cpp","java","javascript","python","ruby","go","rust","swift","kotlin","brainfuck"]},{label:"LydiaHallie \xB7 JavaScript Questions",owner:"lydiahallie",repo:"javascript-questions",license:"MIT",licenseUrl:"https://github.com/lydiahallie/javascript-questions/blob/main/LICENSE",languages:["javascript","typescript","plaintext"]},{label:"denysdovhan \xB7 wtfjs",owner:"denysdovhan",repo:"wtfjs",license:"MIT",licenseUrl:"https://github.com/denysdovhan/wtfjs/blob/master/LICENSE",languages:["javascript","typescript","plaintext"]},{label:"satwikkansal \xB7 wtfpython",owner:"satwikkansal",repo:"wtfpython",license:"MIT",licenseUrl:"https://github.com/satwikkansal/wtfpython/blob/master/LICENSE",languages:["python","plaintext"]},{label:"30 Seconds of Interviews",owner:"30-seconds",repo:"30-seconds-of-interviews",license:"MIT",licenseUrl:"https://github.com/30-seconds/30-seconds-of-interviews/blob/master/LICENSE",languages:["javascript","typescript","plaintext"]},{label:"awesome-programming-quotes",owner:"ashishb",repo:"awesome-programming-quotes",license:"See repository license",licenseUrl:"https://github.com/ashishb/awesome-programming-quotes",languages:["plaintext"]},{label:"programming-memes",owner:"abhisheknaiidu",repo:"programming-memes",license:"See repository license",licenseUrl:"https://github.com/abhisheknaiidu/programming-memes",languages:["plaintext"]}],ie=U.reduce((e,n)=>{for(let t of n.languages)e[t]||(e[t]=[]),e[t].push(n);return e},{}),v=new Map,T=new Map;function C(e){if(!e)return"plaintext";let n=e.toLowerCase();return ee[n]??n}function j(){let e=r.window.activeTextEditor?.document.languageId;return e&&(O=e),O}function oe(e){return N[e]??[]}function re(e){let n=P.extname(e).toLowerCase();if(n){for(let[t,s]of Object.entries(N))if(s.includes(n))return t}}function ae(e,n){let t=e.toLowerCase(),s=P.extname(t);return!(s&&!ne.has(s)||typeof n=="number"&&n>12e4)}function ce(e){return!e||typeof e!="string"?!1:!le(e)}function le(e){if(!e.length)return!1;let n=0;for(let t=0;t<e.length;t++){let s=e.charCodeAt(t);s===9||s===10||s===13||(s===0||s===65533||s<32)&&n++}return n/e.length>se}function L(e){let n=[...e];for(let t=n.length-1;t>0;t--){let s=Math.floor(Math.random()*(t+1));[n[t],n[s]]=[n[s],n[t]]}return n}function u(e){return`${e.owner}/${e.repo}`}function G(e,n){let t=u(e),s=Date.now(),i=typeof n=="number"&&n>s?n:s+15*60*1e3;I.set(t,i);let c=new Date(i).toLocaleTimeString();a(`GitHub rate limit hit for ${e.label}. Cooling down until ${c}.`,"warn")}function de(e){let n=u(e),t=I.get(n);return t?Date.now()<t?!0:(I.delete(n),!1):!1}async function pe(e){let n=u(e);if(T.has(n))return T.get(n);if(e.branch)return T.set(n,e.branch),e.branch;let t=`https://api.github.com/repos/${e.owner}/${e.repo}`;try{let s=await fetch(t);if(s.status===403){let i=s.headers.get("X-RateLimit-Reset"),c=i?parseInt(i,10)*1e3:void 0;throw G(e,c),new Error("GitHub API rate limit exceeded")}if(s.ok){let i=await s.json(),c=typeof i?.default_branch=="string"?i.default_branch:"master";return T.set(n,c),c}a(`Failed to resolve default branch for ${e.label}. Falling back to 'master'.`,"warn")}catch(s){a(`Error resolving branch for ${e.label}.`,"warn",s)}return T.set(n,"master"),"master"}function ge(e,n){return`https://api.github.com/repos/${e.owner}/${e.repo}/git/trees/${n}?recursive=1`}function ue(e,n,t){return`https://raw.githubusercontent.com/${e.owner}/${e.repo}/${n}/`+encodeURI(t).replace(/#/g,"%23")}function he(e,n,t){let s=`// Source: https://github.com/${e.owner}/${e.repo}/blob/${n}/${t}`,i=e.licenseUrl?`// License: ${e.license} (${e.licenseUrl})`:`// License: ${e.license}`;return`${s}
${i}

`}function $(e,n){let t=u(e),s=v.get(t);s&&(s.entries=s.entries.filter(i=>i.path!==n),v.set(t,s))}async function fe(e){try{let n=await pe(e);a(`Fetching repository tree from GitHub for ${e.label} (${n}).`);let t=await fetch(ge(e,n));if(t.status===403){let o=t.headers.get("X-RateLimit-Reset"),d=o?parseInt(o,10)*1e3:void 0;G(e,d),v.delete(u(e));return}if(!t.ok)throw new Error(`Failed to fetch repository tree: ${t.status}`);let s=await t.json(),c=(Array.isArray(s?.tree)?s.tree:[]).filter(o=>o?.type==="blob"&&typeof o?.path=="string").map(o=>({path:o.path,size:typeof o.size=="number"?o.size:0})).filter(o=>ae(o.path,o.size));v.set(u(e),{entries:c,timestamp:Date.now(),branch:n}),a(`Cached ${c.length} files from ${e.label}.`)}catch(n){a(`Error refreshing repository cache for ${e.label}.`,"error",n),v.delete(u(e))}}async function me(e){if(de(e)){let i=u(e),c=I.get(i)??0;a(`${e.label} is on cooldown until ${new Date(c).toLocaleTimeString()}. Skipping.`,"warn");return}let n=u(e),t=v.get(n),s=Date.now();return(!t||s-t.timestamp>Z||t.entries.length===0)&&await fe(e),v.get(n)}async function be(e,n,t){let s=await me(e);if(!s||s.entries.length===0){a(`Repository cache empty for ${e.label}.`,"warn");return}let{entries:i,branch:c}=s,o=e.label,d=t.length>0?i.filter(f=>t.some(S=>f.path.toLowerCase().endsWith(S))):i;if(d.length===0&&(a(`No files with extensions ${t.join(", ")} in ${o}.`,"warn"),!e.languages.includes(n)))return;let h=d.length>0?d:i;if(h.length===0){a(`No entries available in ${o}.`,"warn");return}let l=Math.min(te,h.length),g=L(h).slice(0,l);for(let f of g)try{let S=ue(e,c,f.path),D=await fetch(S);if(!D.ok){a(`Failed to download ${f.path} from ${o}.`,"warn"),$(e,f.path);continue}let R=await D.text();if(!ce(R)){a(`File flagged as unsafe: ${f.path} (${o}).`,"warn"),$(e,f.path);continue}let H=R.length>2e4?"// Repository content is too large to display.":R,k=re(f.path)??n??"plaintext",K=k===n?"":`// Could not find a '${n}' file. Displaying '${k}'.

`,J=he(e,c,f.path);return a(`Loaded snippet from ${f.path} (${o}).`),y=u(e),{code:J+K+H,languageId:k}}catch(S){a(`Failed to process ${f.path} from ${o}.`,"warn",S),$(e,f.path)}}async function _(e){let n=C(e),t=oe(n),s=ie[n]??[],i=new Set(s.map(l=>u(l))),c=U.filter(l=>!i.has(u(l))),o=s.filter(l=>u(l)!==y),d=c.filter(l=>u(l)!==y),h=[...L(o.length>0?o:[]),...L(d)];if(y){let l=U.find(g=>u(g)===y);l&&h.push(l)}for(let l of h){a(`Trying ${l.label} for '${n}' snippets.`);let g=await be(l,n,t);if(g)return g}return a("No suitable repository file found after checking all sources. Using fallback snippet.","warn"),y=void 0,Se(n)}async function W(e){if(p){a("Screen saver already open. Revealing existing panel."),p.reveal(r.ViewColumn.One);return}a("Creating screen saver webview."),p=r.window.createWebviewPanel("screenSaver","Screen Saver",r.ViewColumn.One,{enableScripts:!0,localResourceRoots:[r.Uri.joinPath(e.extensionUri,"media")]}),p.webview.html=we(e,p.webview),p.onDidDispose(()=>{a("Screen saver webview disposed."),p=void 0},null,e.subscriptions),p.webview.onDidReceiveMessage(async c=>{let o=j();switch(c.command){case"exitScreenSaver":a("Received exit command from webview."),p&&p.dispose();break;case"requestNewGist":a(`Webview requested new snippet for '${o}'.`);let d=await _(o);p&&p.webview.postMessage({command:"loadCode",...d});break;case"userActivity":x?.();break}},void 0,e.subscriptions);let n=j(),s=r.workspace.getConfiguration("screenSaver").get("typingSpeed",40);a(`Loading initial snippet for '${n}'.`);let i=await _(n);p&&(p.webview.postMessage({command:"loadCode",typingSpeed:s,...i}),a("Initial snippet sent to webview."))}function we(e,n){let t=r.Uri.joinPath(e.extensionUri,"media","webview.html");if(!b.existsSync(t.fsPath))return"<html><body><h1>Error: webview.html not found!</h1></body></html>";let s=b.readFileSync(t.fsPath,"utf8"),i=n.asWebviewUri(r.Uri.joinPath(e.extensionUri,"media","styles.css")),c=n.asWebviewUri(r.Uri.joinPath(e.extensionUri,"media","main.js"));return s.replace(/\{\{cspSource\}\}/g,n.cspSource).replace(/\{\{styleUri\}\}/g,i.toString()).replace(/\{\{scriptUri\}\}/g,c.toString())}function ve(e){a('"coding-screensaver" is now active.');try{Te(e),m.length>0&&a(`Loaded ${m.length} code-pack fallback snippets.`)}catch(s){a("Failed to load code-pack snippets.","warn",s)}let n=()=>{if(w&&clearTimeout(w),j(),!r.window.state.focused){a("Window not focused. Idle timer paused.");return}let i=r.workspace.getConfiguration("screenSaver").get("idleTimeSeconds",300);if(i>0){let c=new Date(Date.now()+i*1e3);a(`Idle timer armed for ${i} seconds. Scheduled at ${c.toLocaleTimeString()}.`),w=setTimeout(()=>{a("Idle timer elapsed. Launching screen saver."),W(e)},i*1e3)}else a("Idle timer disabled via configuration.")};x=n,e.subscriptions.push(r.workspace.onDidChangeTextDocument(()=>n())),e.subscriptions.push(r.window.onDidChangeTextEditorSelection(()=>n())),e.subscriptions.push(r.window.onDidChangeActiveTextEditor(()=>n())),e.subscriptions.push(r.window.onDidChangeTextEditorVisibleRanges(()=>n())),e.subscriptions.push(r.window.onDidChangeActiveTerminal(()=>n())),e.subscriptions.push(r.window.onDidOpenTerminal(()=>n())),e.subscriptions.push(r.window.onDidCloseTerminal(()=>n())),r.window.onDidChangeActiveNotebookEditor&&e.subscriptions.push(r.window.onDidChangeActiveNotebookEditor(()=>n())),r.window.onDidChangeVisibleNotebookEditors&&e.subscriptions.push(r.window.onDidChangeVisibleNotebookEditors(()=>n()));let t=r.window.onDidWriteTerminalData;t&&e.subscriptions.push(t(()=>n())),e.subscriptions.push(r.window.onDidChangeVisibleTextEditors(()=>n())),e.subscriptions.push(r.workspace.onDidOpenTextDocument(()=>n())),e.subscriptions.push(r.workspace.onDidCloseTextDocument(()=>n())),r.workspace.onDidChangeNotebookDocument&&e.subscriptions.push(r.workspace.onDidChangeNotebookDocument(()=>n())),typeof r.commands.onDidExecuteCommand=="function"&&e.subscriptions.push(r.commands.onDidExecuteCommand(s=>{s?.command?.startsWith("screenSaver.")||n()})),e.subscriptions.push(r.window.onDidChangeWindowState(s=>{s.focused?n():(w&&clearTimeout(w),p&&p.dispose())})),e.subscriptions.push(r.commands.registerCommand("screenSaver.test",()=>{W(e)})),n()}function ye(){p&&p.dispose(),w&&clearTimeout(w),x=void 0}function Se(e){let n=m.length>0?m:Array.from(F),t=e?C(e):void 0,s=t?n.filter(c=>C(c.languageId)===t):[],i=s.length>0?s:n;return i.length===0?F[0]:i[Math.floor(Math.random()*i.length)]}function Te(e){try{let n=r.Uri.joinPath(e.extensionUri,"docs","code-pack.json"),t=r.Uri.joinPath(e.extensionUri,"docs","code-pack.md");if(b.existsSync(n.fsPath)){let s=b.readFileSync(n.fsPath,"utf8");m=Ee(s)}else if(b.existsSync(t.fsPath)){let s=b.readFileSync(t.fsPath,"utf8");m=Ce(s)}else m=[]}catch(n){m=[],a("Failed to parse code-pack content.","warn",n)}m.length===0&&a("No code-pack entries detected. Using built-in fallback snippets.","warn")}function Ce(e){let n=[],t=new Set,s=/```([A-Za-z0-9_+-]+)?\n([\s\S]*?)```/g,i;for(;(i=s.exec(e))!==null;){let d=(i[1]||"plaintext").trim(),h=C(d),l=i[2];if(l.trim().length>0){let g=`${h}::${l}`;t.has(g)||(t.add(g),n.push({code:l,languageId:h}))}}let c=e.split(/\r?\n/),o=!1;for(let d of c){if(d.startsWith("```")){o=!o;continue}if(o)continue;let h=d.trim();if(h.startsWith("- ")){let l=h.slice(2).trim();if(l){let g=`plaintext::${l}`;t.has(g)||(t.add(g),n.push({code:l,languageId:"plaintext"}))}}}return n}function Ee(e){let n=[],t=new Set,s;try{s=JSON.parse(e)}catch(o){return a("Invalid JSON in code-pack.","warn",o),n}let i=Array.isArray(s)?s:Array.isArray(s?.entries)?s.entries:[],c=o=>{if(!o)return;let d=typeof o.code=="string"?o.code:typeof o.text=="string"?o.text:void 0;if(!d)return;let h=typeof o.languageId=="string"?o.languageId:typeof o.language=="string"?o.language:typeof o.lang=="string"?o.lang:"plaintext",l=C(h),g=`${l}::${d}`;t.has(g)||(t.add(g),n.push({code:d,languageId:l}))};for(let o of i)if(Array.isArray(o?.variants))for(let d of o.variants)c({...o,...d,variants:void 0});else c(o);return n}0&&(module.exports={activate,deactivate});
