"use strict";var Y=Object.create;var A=Object.defineProperty;var Z=Object.getOwnPropertyDescriptor;var ee=Object.getOwnPropertyNames;var ne=Object.getPrototypeOf,te=Object.prototype.hasOwnProperty;var se=(e,n)=>{for(var t in n)A(e,t,{get:n[t],enumerable:!0})},W=(e,n,t,s)=>{if(n&&typeof n=="object"||typeof n=="function")for(let o of ee(n))!te.call(e,o)&&o!==t&&A(e,o,{get:()=>n[o],enumerable:!(s=Z(n,o))||s.enumerable});return e};var j=(e,n,t)=>(t=e!=null?Y(ne(e)):{},W(n||!e||!e.__esModule?A(t,"default",{value:e,enumerable:!0}):t,e)),ie=e=>W(A({},"__esModule",{value:!0}),e);var je={};se(je,{activate:()=>ke,deactivate:()=>Re});module.exports=ie(je);var r=j(require("vscode")),y=j(require("fs")),M=j(require("path")),G=[{code:"// Offline fallback: add entries to docs/code-pack.json (or .md) to customize snippets.",languageId:"plaintext"}],g,m,I,H="plaintext",P=new Map,F,b=[],$=40,v,T=!1,oe=6*60*60*1e3,re={javascriptreact:"javascript",typescriptreact:"typescript",react:"javascript","c++":"cpp","objective-c++":"cpp","objective-c":"c",shellscript:"shell",shell:"shell",bash:"shell",zsh:"shell",sh:"shell",jsonc:"json",json5:"json",md:"plaintext",markdown:"plaintext","c#":"csharp",cs:"csharp",ps:"powershell",ps1:"powershell",psm1:"powershell",psd1:"powershell",powershellscript:"powershell",yml:"yaml",ts:"typescript",py:"python",rb:"ruby"},O={brainfuck:[".bf"],c:[".c",".h"],csharp:[".cs"],cpp:[".cc",".cpp",".cxx",".hpp",".hh",".hxx"],css:[".css"],go:[".go"],html:[".html",".htm"],java:[".java"],javascript:[".js",".jsx",".mjs",".cjs"],json:[".json"],kotlin:[".kt"],lua:[".lua"],php:[".php"],powershell:[".ps1",".psm1"],python:[".py"],ruby:[".rb"],rust:[".rs"],scala:[".scala"],shell:[".sh",".bash",".zsh"],sql:[".sql"],swift:[".swift"],typescript:[".ts",".tsx"],yaml:[".yml",".yaml"],plaintext:[".md",".markdown",".txt"]},ae=new Set(Object.values(O).flat()),ce=6,le=.12;function c(e,n="log",...t){let o=`[${new Date().toLocaleTimeString()}] ${e}`;switch(n){case"warn":console.warn(o,...t);break;case"error":console.error(o,...t);break;default:console.log(o,...t);break}}var k=[{label:"TheAlgorithms \xB7 Python",owner:"TheAlgorithms",repo:"Python",license:"MIT",licenseUrl:"https://github.com/TheAlgorithms/Python/blob/master/LICENSE",languages:["python"],configId:"theAlgorithmsPython"},{label:"TheAlgorithms \xB7 JavaScript",owner:"TheAlgorithms",repo:"JavaScript",license:"MIT",licenseUrl:"https://github.com/TheAlgorithms/JavaScript/blob/master/LICENSE",languages:["javascript","typescript"],configId:"theAlgorithmsJavaScript"},{label:"TheAlgorithms \xB7 Java",owner:"TheAlgorithms",repo:"Java",license:"MIT",licenseUrl:"https://github.com/TheAlgorithms/Java/blob/master/LICENSE",languages:["java"],configId:"theAlgorithmsJava"},{label:"TheAlgorithms \xB7 C",owner:"TheAlgorithms",repo:"C",license:"MIT",licenseUrl:"https://github.com/TheAlgorithms/C/blob/main/LICENSE",languages:["c"],configId:"theAlgorithmsC"},{label:"TheAlgorithms \xB7 C++",owner:"TheAlgorithms",repo:"C-Plus-Plus",license:"MIT",licenseUrl:"https://github.com/TheAlgorithms/C-Plus-Plus/blob/master/LICENSE",languages:["cpp"],configId:"theAlgorithmsCpp"},{label:"TheAlgorithms \xB7 Go",owner:"TheAlgorithms",repo:"Go",license:"MIT",licenseUrl:"https://github.com/TheAlgorithms/Go/blob/master/LICENSE",languages:["go"],configId:"theAlgorithmsGo"},{label:"TheAlgorithms \xB7 Rust",owner:"TheAlgorithms",repo:"Rust",license:"MIT",licenseUrl:"https://github.com/TheAlgorithms/Rust/blob/master/LICENSE",languages:["rust"],configId:"theAlgorithmsRust"},{label:"TheAlgorithms \xB7 Kotlin",owner:"TheAlgorithms",repo:"Kotlin",license:"MIT",licenseUrl:"https://github.com/TheAlgorithms/Kotlin/blob/master/LICENSE",languages:["kotlin"],configId:"theAlgorithmsKotlin"},{label:"30 Seconds of Code",owner:"30-seconds",repo:"30-seconds-of-code",license:"CC0 1.0 Universal",licenseUrl:"https://github.com/30-seconds/30-seconds-of-code/blob/master/LICENSE",languages:["javascript","typescript","react"],configId:"thirtySecondsOfCode"},{label:"1loc",owner:"phuoc-ng",repo:"1loc",license:"MIT",licenseUrl:"https://github.com/phuoc-ng/1loc/blob/master/LICENSE",languages:["javascript"],configId:"oneLoc"},{label:"leachim6 \xB7 Hello World",owner:"leachim6",repo:"hello-world",license:"CC BY 4.0",licenseUrl:"https://github.com/leachim6/hello-world/blob/master/LICENSE",languages:["plaintext","c","cpp","java","javascript","python","ruby","go","rust","swift","kotlin","brainfuck"],configId:"helloWorld"},{label:"LydiaHallie \xB7 JavaScript Questions",owner:"lydiahallie",repo:"javascript-questions",license:"MIT",licenseUrl:"https://github.com/lydiahallie/javascript-questions/blob/main/LICENSE",languages:["javascript","typescript","plaintext"],configId:"javascriptQuestions"},{label:"denysdovhan \xB7 wtfjs",owner:"denysdovhan",repo:"wtfjs",license:"MIT",licenseUrl:"https://github.com/denysdovhan/wtfjs/blob/master/LICENSE",languages:["javascript","typescript","plaintext"],configId:"wtfjs"},{label:"satwikkansal \xB7 wtfpython",owner:"satwikkansal",repo:"wtfpython",license:"MIT",licenseUrl:"https://github.com/satwikkansal/wtfpython/blob/master/LICENSE",languages:["python","plaintext"],configId:"wtfpython"},{label:"30 Seconds of Interviews",owner:"30-seconds",repo:"30-seconds-of-interviews",license:"MIT",licenseUrl:"https://github.com/30-seconds/30-seconds-of-interviews/blob/master/LICENSE",languages:["javascript","typescript","plaintext"],configId:"thirtySecondsOfInterviews"},{label:"awesome-programming-quotes",owner:"ashishb",repo:"awesome-programming-quotes",license:"See repository license",licenseUrl:"https://github.com/ashishb/awesome-programming-quotes",languages:["plaintext"],configId:"awesomeProgrammingQuotes"},{label:"programming-memes",owner:"abhisheknaiidu",repo:"programming-memes",license:"See repository license",licenseUrl:"https://github.com/abhisheknaiidu/programming-memes",languages:["plaintext"],configId:"programmingMemes"}],de=k.map(e=>e.configId).filter(e=>typeof e=="string"),ge=k.reduce((e,n)=>{for(let t of n.languages)e[t]||(e[t]=[]),e[t].push(n);return e},{}),S=new Map,C=new Map;function R(e){if(!e)return"plaintext";let n=e.toLowerCase();return re[n]??n}function q(){let n=r.workspace.getConfiguration("screenSaver").get("repositories.enabled");return Array.isArray(n)?new Set(n):new Set(de)}function N(){let e=r.window.activeTextEditor?.document.languageId;return e&&(H=e),H}function pe(e){return O[e]??[]}function ue(e){let n=M.extname(e).toLowerCase();if(n){for(let[t,s]of Object.entries(O))if(s.includes(n))return t}}function he(e,n){let t=e.toLowerCase(),s=M.extname(t);return!(s&&!ae.has(s)||typeof n=="number"&&n>12e4)}function fe(e){return!e||typeof e!="string"?!1:!me(e)}function me(e){if(!e.length)return!1;let n=0;for(let t=0;t<e.length;t++){let s=e.charCodeAt(t);s===9||s===10||s===13||(s===0||s===65533||s<32)&&n++}return n/e.length>le}function D(e){let n=[...e];for(let t=n.length-1;t>0;t--){let s=Math.floor(Math.random()*(t+1));[n[t],n[s]]=[n[s],n[t]]}return n}function p(e){return`${e.owner}/${e.repo}`}function z(e,n){let t=p(e),s=Date.now(),o=typeof n=="number"&&n>s?n:s+15*60*1e3;P.set(t,o);let a=new Date(o).toLocaleTimeString();c(`GitHub rate limit hit for ${e.label}. Cooling down until ${a}.`,"warn")}function we(e){let n=p(e),t=P.get(n);return t?Date.now()<t?!0:(P.delete(n),!1):!1}async function be(e){let n=p(e);if(C.has(n))return C.get(n);if(e.branch)return C.set(n,e.branch),e.branch;let t=`https://api.github.com/repos/${e.owner}/${e.repo}`;try{let s=await fetch(t);if(s.status===403){let o=s.headers.get("X-RateLimit-Reset"),a=o?parseInt(o,10)*1e3:void 0;throw z(e,a),new Error("GitHub API rate limit exceeded")}if(s.ok){let o=await s.json(),a=typeof o?.default_branch=="string"?o.default_branch:"master";return C.set(n,a),a}c(`Failed to resolve default branch for ${e.label}. Falling back to 'master'.`,"warn")}catch(s){c(`Error resolving branch for ${e.label}.`,"warn",s)}return C.set(n,"master"),"master"}function ve(e,n){return`https://api.github.com/repos/${e.owner}/${e.repo}/git/trees/${n}?recursive=1`}function ye(e,n,t){return`https://raw.githubusercontent.com/${e.owner}/${e.repo}/${n}/`+encodeURI(t).replace(/#/g,"%23")}function Se(e,n,t){let s=`// Source: https://github.com/${e.owner}/${e.repo}/blob/${n}/${t}`,o=e.licenseUrl?`// License: ${e.license} (${e.licenseUrl})`:`// License: ${e.license}`;return`${s}
${o}

`}function x(e,n){let t=p(e),s=S.get(t);s&&(s.entries=s.entries.filter(o=>o.path!==n),S.set(t,s))}async function Ie(e){try{let n=await be(e);c(`Fetching repository tree from GitHub for ${e.label} (${n}).`);let t=await fetch(ve(e,n));if(t.status===403){let i=t.headers.get("X-RateLimit-Reset"),d=i?parseInt(i,10)*1e3:void 0;z(e,d),S.delete(p(e));return}if(!t.ok)throw new Error(`Failed to fetch repository tree: ${t.status}`);let s=await t.json(),a=(Array.isArray(s?.tree)?s.tree:[]).filter(i=>i?.type==="blob"&&typeof i?.path=="string").map(i=>({path:i.path,size:typeof i.size=="number"?i.size:0})).filter(i=>he(i.path,i.size));S.set(p(e),{entries:a,timestamp:Date.now(),branch:n}),c(`Cached ${a.length} files from ${e.label}.`)}catch(n){c(`Error refreshing repository cache for ${e.label}.`,"error",n),S.delete(p(e))}}async function Ce(e){if(we(e)){let o=p(e),a=P.get(o)??0;c(`${e.label} is on cooldown until ${new Date(a).toLocaleTimeString()}. Skipping.`,"warn");return}let n=p(e),t=S.get(n),s=Date.now();return(!t||s-t.timestamp>oe||t.entries.length===0)&&await Ie(e),S.get(n)}async function Te(e,n,t){let s=await Ce(e);if(!s||s.entries.length===0){c(`Repository cache empty for ${e.label}.`,"warn");return}let{entries:o,branch:a}=s,i=e.label,d=t.length>0?o.filter(l=>t.some(w=>l.path.toLowerCase().endsWith(w))):o;if(d.length===0&&(c(`No files with extensions ${t.join(", ")} in ${i}.`,"warn"),!e.languages.includes(n)))return;let u=d.length>0?d:o;if(u.length===0){c(`No entries available in ${i}.`,"warn");return}let h=Math.min(ce,u.length),f=D(u).slice(0,h);for(let l of f)try{let w=ye(e,a,l.path),_=await fetch(w);if(!_.ok){c(`Failed to download ${l.path} from ${i}.`,"warn"),x(e,l.path);continue}let U=await _.text();if(!fe(U)){c(`File flagged as unsafe: ${l.path} (${i}).`,"warn"),x(e,l.path);continue}let B=U.length>2e4?"// Repository content is too large to display.":U,L=ue(l.path)??n??"plaintext",V=L===n?"":`// Could not find a '${n}' file. Displaying '${L}'.

`,Q=Se(e,a,l.path),X=`https://github.com/${e.owner}/${e.repo}/blob/${a}/${l.path}`;return c(`Loaded snippet from ${l.path} (${i}).`),I=p(e),{code:Q+V+B,languageId:L,sourceUrl:X}}catch(w){c(`Failed to process ${l.path} from ${i}.`,"warn",w),x(e,l.path)}}async function J(e){let n=R(e),t=pe(n),s=q(),o=l=>l.configId?s.has(l.configId):!0,a=(ge[n]??[]).filter(o),i=new Set(a.map(l=>p(l))),d=k.filter(l=>o(l)&&!i.has(p(l))),u=a.filter(l=>p(l)!==I),h=d.filter(l=>p(l)!==I),f=[...D(u.length>0?u:[]),...D(h)];if(I){let l=k.find(w=>p(w)===I);l&&o(l)&&f.push(l)}for(let l of f){c(`Trying ${l.label} for '${n}' snippets.`);let w=await Te(l,n,t);if(w)return w}return c("No suitable repository file found after checking all sources. Using fallback snippet.","warn"),I=void 0,Ae(n)}function E(e,n,t=0){if(!g){v=void 0;return}let s={payload:e,reason:n};if(v=s,!T)return;let o=g;if(!o){v=void 0;return}(async()=>{if(!await o.webview.postMessage({command:"loadCode",...e})){if(t>=3){c(`Webview rejected ${n} snippet delivery after ${t+1} attempts.`,"warn");return}let i=Math.min(500,100*(t+1));setTimeout(()=>E(e,n,t+1),i);return}v===s&&(v=void 0),c(n==="initial"?"Initial snippet sent to webview.":"Next snippet sent to webview.")})().catch(a=>{if(c(`Failed to deliver ${n} snippet to webview.`,"warn",a),t<3){let i=Math.min(500,100*(t+1));setTimeout(()=>E(e,n,t+1),i)}})}async function K(e){if(!r.window.state.focused){c("Skipping screen saver launch because VS Code window is not focused."),m&&(clearTimeout(m),m=void 0);return}if(g){c("Screen saver already open. Revealing existing panel."),g.reveal(r.ViewColumn.One);return}c("Creating screen saver webview."),g=r.window.createWebviewPanel("screenSaver","Screen Saver",r.ViewColumn.One,{enableScripts:!0,localResourceRoots:[r.Uri.joinPath(e.extensionUri,"media")]}),T=!1,v=void 0,g.webview.html=Ee(e,g.webview),g.onDidDispose(()=>{c("Screen saver webview disposed."),g=void 0,v=void 0,T=!1},null,e.subscriptions),g.webview.onDidReceiveMessage(async s=>{let o=N();switch(s.command){case"exitScreenSaver":c("Received exit command from webview."),v=void 0,T=!1,g&&g.dispose();break;case"requestNewGist":c(`Webview requested new snippet for '${o}'.`);let a=await J(o);g&&($=r.workspace.getConfiguration("screenSaver").get("typingSpeed",40),E({typingSpeed:$,...a},"update"));break;case"userActivity":F?.();break;case"webviewReady":{T=!0;let i=v;i&&E(i.payload,i.reason);break}case"openExternalUrl":{let i=s.url;typeof i=="string"&&(i.startsWith("http://")||i.startsWith("https://"))&&r.env.openExternal(r.Uri.parse(i));break}}},void 0,e.subscriptions);let n=N();$=r.workspace.getConfiguration("screenSaver").get("typingSpeed",40),c(`Loading initial snippet for '${n}'.`);let t=await J(n);g&&E({typingSpeed:$,...t},"initial")}function Ee(e,n){let t=r.Uri.joinPath(e.extensionUri,"media","webview.html");if(!y.existsSync(t.fsPath))return"<html><body><h1>Error: webview.html not found!</h1></body></html>";let s=y.readFileSync(t.fsPath,"utf8"),o=n.asWebviewUri(r.Uri.joinPath(e.extensionUri,"media","styles.css")),a=n.asWebviewUri(r.Uri.joinPath(e.extensionUri,"media","main.js"));return s.replace(/\{\{cspSource\}\}/g,n.cspSource).replace(/\{\{styleUri\}\}/g,o.toString()).replace(/\{\{scriptUri\}\}/g,a.toString())}function ke(e){c('"coding-screensaver" is now active.');try{Pe(e),b.length>0&&c(`Loaded ${b.length} code-pack fallback snippets.`)}catch(t){c("Failed to load code-pack snippets.","warn",t)}let n=()=>{if(m&&(clearTimeout(m),m=void 0),N(),!r.window.state.focused){c("Window not focused. Idle timer paused.");return}let s=r.workspace.getConfiguration("screenSaver").get("idleTimeSeconds",300);if(s>0&&s<5&&(c(`Configured idle time of ${s}s is too short. Using minimum of 5s.`,"warn"),s=5),s>0){let o=new Date(Date.now()+s*1e3);c(`Idle timer armed for ${s} seconds. Scheduled at ${o.toLocaleTimeString()}.`),m=setTimeout(()=>{m=void 0,c("Idle timer elapsed. Launching screen saver."),K(e)},s*1e3)}else c("Idle timer disabled via configuration.")};F=n,e.subscriptions.push(r.workspace.onDidChangeTextDocument(()=>n())),e.subscriptions.push(r.window.onDidChangeTextEditorSelection(()=>n())),e.subscriptions.push(r.window.onDidChangeActiveTextEditor(()=>n())),e.subscriptions.push(r.window.onDidChangeTextEditorVisibleRanges(()=>n())),e.subscriptions.push(r.window.onDidChangeActiveTerminal(()=>n())),e.subscriptions.push(r.window.onDidOpenTerminal(()=>n())),e.subscriptions.push(r.window.onDidCloseTerminal(()=>n())),r.window.onDidChangeActiveNotebookEditor&&e.subscriptions.push(r.window.onDidChangeActiveNotebookEditor(()=>n())),r.window.onDidChangeVisibleNotebookEditors&&e.subscriptions.push(r.window.onDidChangeVisibleNotebookEditors(()=>n())),e.subscriptions.push(r.window.onDidChangeVisibleTextEditors(()=>n())),e.subscriptions.push(r.workspace.onDidOpenTextDocument(()=>n())),e.subscriptions.push(r.workspace.onDidCloseTextDocument(()=>n())),r.workspace.onDidChangeNotebookDocument&&e.subscriptions.push(r.workspace.onDidChangeNotebookDocument(()=>n())),typeof r.commands.onDidExecuteCommand=="function"&&e.subscriptions.push(r.commands.onDidExecuteCommand(t=>{t?.command?.startsWith("screenSaver.")||n()})),e.subscriptions.push(r.window.onDidChangeWindowState(t=>{t.focused?setTimeout(()=>n(),0):(m&&(clearTimeout(m),m=void 0,c("Window lost focus. Idle timer reset.")),g&&g.dispose())})),e.subscriptions.push(r.commands.registerCommand("screenSaver.test",()=>{K(e)})),e.subscriptions.push(r.commands.registerCommand("screenSaver.configureRepositories",async()=>{await $e()})),n()}function Re(){g&&g.dispose(),m&&clearTimeout(m),F=void 0}function Ae(e){let n=b.length>0?b:Array.from(G),t=e?R(e):void 0,s=t?n.filter(a=>R(a.languageId)===t):[],o=s.length>0?s:n;return o.length===0?G[0]:o[Math.floor(Math.random()*o.length)]}async function $e(){let e=q(),n=k.map(a=>({label:a.label,description:a.languages.join(", "),picked:!a.configId||e.has(a.configId),repository:a})),t=await r.window.showQuickPick(n,{canPickMany:!0,title:"Select repositories for Coding Screen Saver"});if(!t)return;let s=t.map(a=>a.repository.configId).filter(a=>typeof a=="string");await r.workspace.getConfiguration("screenSaver").update("repositories.enabled",s,r.ConfigurationTarget.Workspace),c(`Repository selection updated. ${s.length} enabled.`)}function Pe(e){try{let n=r.Uri.joinPath(e.extensionUri,"docs","code-pack.json"),t=r.Uri.joinPath(e.extensionUri,"docs","code-pack.md");if(y.existsSync(n.fsPath)){let s=y.readFileSync(n.fsPath,"utf8");b=Le(s)}else if(y.existsSync(t.fsPath)){let s=y.readFileSync(t.fsPath,"utf8");b=Ue(s)}else b=[]}catch(n){b=[],c("Failed to parse code-pack content.","warn",n)}b.length===0&&c("No code-pack entries detected. Using built-in fallback snippets.","warn")}function Ue(e){let n=[],t=new Set,s=/```([A-Za-z0-9_+-]+)?\n([\s\S]*?)```/g,o;for(;(o=s.exec(e))!==null;){let d=(o[1]||"plaintext").trim(),u=R(d),h=o[2];if(h.trim().length>0){let f=`${u}::${h}`;t.has(f)||(t.add(f),n.push({code:h,languageId:u}))}}let a=e.split(/\r?\n/),i=!1;for(let d of a){if(d.startsWith("```")){i=!i;continue}if(i)continue;let u=d.trim();if(u.startsWith("- ")){let h=u.slice(2).trim();if(h){let f=`plaintext::${h}`;t.has(f)||(t.add(f),n.push({code:h,languageId:"plaintext"}))}}}return n}function Le(e){let n=[],t=new Set,s;try{s=JSON.parse(e)}catch(i){return c("Invalid JSON in code-pack.","warn",i),n}let o=Array.isArray(s)?s:Array.isArray(s?.entries)?s.entries:[],a=i=>{if(!i)return;let d=typeof i.code=="string"?i.code:typeof i.text=="string"?i.text:void 0;if(!d)return;let u=typeof i.languageId=="string"?i.languageId:typeof i.language=="string"?i.language:typeof i.lang=="string"?i.lang:"plaintext",h=R(u),f=`${h}::${d}`;t.has(f)||(t.add(f),n.push({code:d,languageId:h}))};for(let i of o)if(Array.isArray(i?.variants))for(let d of i.variants)a({...i,...d,variants:void 0});else a(i);return n}0&&(module.exports={activate,deactivate});
